<!--
 * @Author       : Jia Zeng
 * @LastEditTime : 2021-04-30 7:12 PM
-->

<!DOCTYPE html>
<html lang="zh-cmn" dir="ltr">

<head>
  <meta charset="UTF-8">
  <title>原神地图 - Genshin Impact Map</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,minimal-ui" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge,chrome=1" />
  <meta name="renderer" content="webkit" />
  <meta name="force-rendering" content="webkit" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="msappdivcation-navbutton-color" content="#ffffff" />
  <meta name="apple-mobile-web-app-status-bar-style" content="lack-translucent" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="google" value="notranslate">
  <meta name="keywords" content="原神地図,Choose-country-region,Genshin,Genshin Impact Map" />
  <meta name="description" content="Choose-country-region - Genshin Map" />
  <!-- Open Graph -->
  <meta property="fb:app_id" content="3340670332825887" />
  <meta property="og:url" content="https://yuanshen.site/" />
  <meta property="og:title" content="原神地图" />
  <meta property="og:site_name" content="Genshin Impact Map" />
  <meta property="og:description" content="米游社空荧酒馆制作的原神全资源攻略地图。" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://yuanshen.site/tiles_test/4/ppp10_9.jpg" />
  <meta property="og:locale" content="zh-CN" />
  <meta name="twitter:widgets:csp" content="on">
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@yuanshen_site" />
  <meta name="twitter:image:src" content="https://yuanshen.site/tiles_test/4/ppp10_9.jpg" />
  <meta name="twitter:creator" content="@yuanshen_site" />
  <meta property="twitter:url" content="https://yuanshen.site/" />
  <meta property="twitter:type" content="website" />
  <meta property="twitter:title" content="原神地图" />
  <meta property="twitter:description" content="米游社空荧酒馆制作的原神全资源攻略地图。" />
  <meta property="twitter:image" content="https://yuanshen.site/tiles_test/4/ppp10_9.jpg" />
  <meta property="url" content="https://yuanshen.site/" />
  <meta property="type" content="website" />
  <meta property="title" content="原神地图" />
  <meta property="description" content="米游社空荧酒馆制作的原神全资源攻略地图。" />
  <meta property="image" content="https://yuanshen.site/tiles_test/4/ppp10_9.jpg" />
  <meta itemprop="name" content="原神地图" />
  <meta itemprop="description" content="米游社空荧酒馆制作的原神全资源攻略地图。" />
  <meta itemprop="image" content="https://yuanshen.site/tiles_test/4/ppp10_9.jpg" />
  <!-- Open Graph -->
  <link rel="canonical" href="https://yuanshen.site/" />
  <link rel="shortcut icon" href="https://yuanshen.site/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="https://yuanshen.site/favicon.ico" sizes="120x120" />
  <link rel="stylesheet" href="./css/global.min.css">
  <link rel="stylesheet" href="./css/loading/loading.css">
  <!-- 开发环境依赖 -->
  <!-- <script src="https://unpkg.com/vue@3.0.11/dist/vue.global.js"></script>
  <script src="https://unpkg.com/vue-i18n@9.1.6/dist/vue-i18n.global.js"></script> -->
  <!-- 生产环境依赖 -->
  <script src="./js/vue-3.0.11.global.prod.js"></script>
  <script src="./js/vue-i18n-9.1.6.global.prod.js"></script>
  <script>
    // 该页面的全局配置
    const globalConfig = {
      theme: {
        themeList: ["dark", "light"], // 主题列表
        defaultTheme: "light", // 默认主题
        autoTheme: true, // 自动切换主题 (即白天light 晚上dark
      },
      resourceReloadingData: 'data/preload.json', // 资源预加载的数据url
      otherData: 'data/loading.json', // 其他数据的url
      maxOverTime: 2500, // 最大延迟[ms] ( 即强制自动重定向的时间, 默认为资源预加载完成后
      loadingBarContainer: '.loading-default', // loadingBar 挂载容器的选择器
      VueContainer: '#app', // vue 挂载容器的选择器
      defaultLanguage: 'en', // 如果用户浏览器主语言不在支持范围内, 回退的语言代码
    };

  </script>

  <head>

  <body data-theme="light">
    <noscript>
      <p>(:</p>
      <p>We're sorry but</p>
      <p>This page requires JavaScript to work properly</p>
    </noscript>
    <div class="wrapper" id="app">
      <div class="loading" v-show="showLoading">
        <!-- 默认加载动画 -->
        <div class="loading-default">
          <img src="./imgs/loading-bar.png" alt="Loading...">
        </div>
        <!-- 移动端加载动画 -->
        <div class="loading-mobile">
          <ul class="rotate">
            <li class="item"></li>
            <li class="item"></li>
            <li class="item"></li>
            <li class="item"></li>
            <li class="item"></li>
          </ul>
          <h2>{{ $t("message.loading") }} ...</h2>
        </div>
        <!-- Loading 提示 -->
        <transition name="slide-fade">
          <p class="loading-tips">
            {{ $t("message.tips.first") }}
            「
            <span class='replace-link'>
              {{ replaceLink }}
            </span>
            」
            <br>
            {{ $t("message.tips.second") }}
            <a href="#" @click="showLoading=false">{{ $t("message.tips.third") }}</a>
          </p>
        </transition>
      </div>
      <header>
        <div class="header-container cover">
          <input type="checkbox" id="checkbox-menustate">
          <nav class="topnav">
            <div class="topnav-container">
              <!-- 移动端侧边栏按钮Icon -->
              <label for="checkbox-menustate" class="menuicon-top" aria-hidden="true">
                <span class="line-first"></span>
                <span class="line-second"></span>
                <span class="line-third"></span>
              </label>
              <a href="#checkbox-menustate" role="button" class="menuanchor-open">Open Menu</a>
              <a href="#" role="button" class="menuanchor-close">Close Menu</a>
              <h1 class="logo">
                <a href="#">{{ $t("message.title") }}</a>
              </h1>
              <ul class="topnav-list">
                <li class="topnav-list-item">
                  <a href="#" class="link arrow">{{ $t("message.language") }}</a>
                  <ul class=nav-dropdown" @click="selectLanguage">
                    <li v-for="(lang, i) in langs" :key="`langs${i}`">
                      <a :href="`?lang=${lang.code}`" :lang="lang.code" v-html="lang.name"></a>
                    </li>
                  </ul>
                </li>
                <li class="topnav-list-item">
                  <a href="https://support.qq.com/products/321980" class="link">
                    {{$t("message.feedback")}}
                  </a>
                </li>
              </ul>
          </nav>
        </div>
      </header>
      <main>
        <nav>
          <div class="content">
            <h2>
              <a href="#">{{$t("message.cycor")}}</a>
            </h2>
          </div>
        </nav>
        <div class="main-container cover">
          <div class="section-container">
            <div v-for="(locale, i) in countryRegion" :key="`locale${i}`" class="section-content">
              <h2 class="category-title"> {{locale.type}} </h2>
              <ul class="category-sections" @click="selectLocation">
                <li class="category-item" v-for="(map, x) in locale.map">
                  <a :href="`#${map.code}`" :class="map.code">
                    <span v-html="map.name" :lang="map.code"></span>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </main>
      <!-- <footer>
        <div class="footer-container cover">
          <div class="annotation">
          
          </div>
          <nav>
            <ul>
              <li><a href=""></a></li>
              <li><a href=""></a></li>
              <li><a href=""></a></li>
            </ul>
          </nav>
        </div>
      </footer> -->
    </div>
    <script type="module">
      import { ResourceReloading, LoadingBar, DynamicTheme } from "./js/module.js";
      import * as utils from "./js/utils.js";
      /**
       * @todo 
       *  refactor
       */
      (async () => {
        const { countryRegion, locale } = await utils.request(globalConfig.otherData).catch(err => console.log(err));
        const localeData = utils.getSupperLocale(locale.support, globalConfig.defaultLanguage);
        console.log('localeData: ', localeData);
        const i18n = VueI18n.createI18n({
          locale: new URLSearchParams(new URL(location.href).search).get("lang") || localeData.code,     // set locale
          fallbackLocale: globalConfig.defaultLanguage,                                                  // set fallback locale
          messages: locale.message,                                                                      // set locale messages
        });
        const app = Vue.createApp({
          data() {
            return {
              replaceLink: localeData.link,
              showLoading: true,
              countryRegion: countryRegion
            }
          },
          created() {
            this.langs = []; // 支持显示的语言列表
            for (const prop in locale.message) {
              if (locale.message.hasOwnProperty(prop)) {
                this.langs.push({ code: prop, name: locale.message[prop].name })
              }
            }
            this.DynamicTheme = new DynamicTheme(globalConfig.theme.themeList);
            if (globalConfig.theme.autoTheme) this.DynamicTheme.autoTheme();
            utils.log([{ pageVersion: "1.1.0", vueVersion: "3.0.11", author: "(*^_^*)", lastEditTime: "2021-4-29" }]);
          },
          mounted() {
            this.$nextTick(function () {
              this.LoadingBar = new LoadingBar(".loading-default", 3000);
              this.LoadingBar.start();
              let timer = setTimeout(() => replace(), globalConfig.maxOverTime);
              new ResourceReloading("data/preload.json").init().then(() => setTimeout(() => replace(), 2500));
              const replace = () => {
                if (this.showLoading) {
                  this.LoadingBar.finish();
                  setTimeout(() => document.location.replace(`https://yuanshen.site/${this.replaceLink}`, 500));
                }
              }
            })
          },
          methods: {
            selectLanguage(e) {
              const lang = e.target.lang;
              this.$i18n.locale = lang;
              lang.includes("ar") ? document.documentElement.setAttribute('dir', "rtl") : document.documentElement.setAttribute('dir', "ltr");
              document.documentElement.setAttribute('lang', lang);
            },
            selectLocation(e) {
              const target = e.target;
              let result = "";
              if (target.tagName === "SPAN") {
                locale.support.forEach((val) => {
                  if (val.node) {
                    for (let i = 0; i < val.node.length; i++) {
                      if (val.node[i].code === target.lang) {
                        console.log(val.node[i].link);
                        result = val.node[i].link;
                      }
                    }
                  }
                  for (let i = 0; i < val.code.length; i++) {
                    if (val.code[i] === target.lang) {
                      result = val.link;
                    }
                  }
                });
                if (result) {
                  document.location.replace(`https://yuanshen.site/${result}`);
                } else {
                  let state = window.confirm(`This area is not currently supported.\n You can go to https://yuanshen.site/index_${globalConfig.defaultLanguage}.html`);
                  if (state) document.location.replace(`https://yuanshen.site/index_${globalConfig.defaultLanguage}.html`);
                }
              }
            }
          }
        })
        app.use(i18n)
        app.mount(globalConfig.VueContainer);
      })();
    </script>
  </body>

</html>
